!function(I){I.selectableTree=function(e,s){if(null!=s&&null!=s.dataSource){var t={colorInHeader:!0,collapsed:!0,iconCollapsed:"fa-angle-up",iconUncollapsed:"fa-angle-down",iconChecked:"fa-circle",iconUnchecked:"fa-circle-o",iconMixchecked:"fa-circle-thin"},c=this;c.settings={};var l=I(e);c.init=function(){c.originalDataSource=s.dataSource,delete s.dataSource,c.settings=I.extend({},t,s),l.html(""),l.addClass("tree").addClass("list-group"),I(c.originalDataSource).each(function(e,n){l.append("<a class='parent list-group-item' data-id='"+String(n.Item.Value)+"'><i class='fa "+c.settings.iconCollapsed+" collapsed'/> "+n.Item.Text+" <span class='badge'></span><i class='fa pull-right check' aria-hidden='true'/></a>");var t=l.children().last();t.find(".check").last().on("click",function(e){o(I(this),l),void 0!==s.onCheck&&s.onCheck(e,d(I(this)))}),t.on("click",function(e){I(e.target).hasClass("check")||r(I(this).find(".collapsed").last())});var a=I(n.Children),i=0;a.each(function(e,t){l.append("<a class='child list-group-item' data-dirty=false data-parent='"+String(n.Item.Value)+"' data-id='"+String(n.Item.Value)+"-"+t.Value+"'><span class='texto'>"+t.Text+"</span><i class='fa pull-right check' aria-hidden='true'></a>");var a=l.children().last();t.Selected?(a.find(".check").last().addClass(c.settings.iconChecked),i+=1):a.find(".check").last().addClass(c.settings.iconChecked),a.data("originalSelected",t.Selected),a.find(".check").last().on("click",function(e){h(I(this),l),void 0!==s.onCheck&&s.onCheck(e,d(I(this)))})}),i==n.Children.length?(c.settings.colorInHeader&&t.addClass("list-group-item-success"),t.find(".check").last().addClass(c.settings.iconChecked)):0<i?(c.settings.colorInHeader&&t.addClass("list-group-item-warning"),t.find(".check").last().addClass(c.settings.iconMixchecked)):(c.settings.colorInHeader&&t.addClass("list-group-item-danger"),t.find(".check").last().addClass(c.settings.iconUnchecked)),0<n.Children.length?t.find(".badge").html(i+" / "+n.Children.length):t.find(".badge,.fa").remove()}),null!=c.settings.collapsed&&1==c.settings.collapsed&&l.find(".collapsed").each(function(e,t){r(I(this))})},c.reset=function(){l.data("selectableTree",null)},c.getDataSource=function(){var i=[];return l.find(".parent").each(function(e,t){var a=new Object;a.Item=new Object,a.Item.Text=I(this).find(".texto").html(),a.Item.Value=I(this).data("id");var n=[];I(u(I(t).find(".check"),l)).each(function(e,t){var a=new Object;a.Selected=C(I(this).find(".check")),a.Text=I(this).find("span").first().html(),a.Value=I(this).data("id").split("-")[1],a.Dirty=I(this).data("dirty"),a.OriginalSelected=I(this).data("originalSelected"),n.push(a)}),a.Children=n,i.push(a)}),i},c.isDirty=function(){return l.data("dirty")};var d=function(e){if(e.parent().hasClass("parent")){var t=new Object;t.Item=new Object,t.Item.Text=e.parent().find(".texto").html(),t.Item.Value=e.parent().data("id");var n=[];return I(u(I(e.parent()).find(".check"),l)).each(function(e,t){var a=new Object;a.Selected=C(I(this).find(".check")),a.Text=I(this).find("span").first().html(),a.Value=I(this).data("id").split("-")[1],a.Dirty=I(this).data("dirty"),a.OriginalSelected=I(this).data("originalSelected"),n.push(a)}),t.Children=n,t}var a=new Object;return a.Selected=C(e),a.Text=e.parent().find("span").first().html(),a.Value=e.parent().data("id").split("-")[1],a.Dirty=e.parent().data("dirty"),a.OriginalSelected=e.parent().data("originalSelected"),a},r=function(e,t){var a=u(e),n=i(e);I(a).each(function(e,t){n?t.show():t.hide()}),f(e)},o=function(e,t){if(null==e.parent().data("parent")){var n=!C(e),a=u(e);I(a).each(function(e,t){var a=t.find(".check");n?k(a):v(a)}),n?(S(I(e)),e.parent().find(".badge").html(I(a).length+" / "+I(a).length)):(b(I(e)),e.parent().find(".badge").html("0 / "+I(a).length))}},h=function(e,t){m(e);var a=p(e),n=0,i=0;I(a).each(function(e,t){n+=1,C(t.find(".check"))&&(i+=1)}),C(e)&&(i+=1),n+=1;var s=g(e.parent().data("parent"),t);s.find(".badge").html(i+" / "+n);var c=s.find(".check");i==n&&i==a.length+1?S(c):0==i?b(c):x(c)},g=function(e,t){return I(t).find(".list-group-item[data-id='"+e+"']")},u=function(n){var i=[];return n.parent().siblings().each(function(e,t){var a=I(t);0<=String(a.data("id")).indexOf("-")&&(String(a.data("id")).split("-")[0]==String(n.parent().data("id"))&&i.push(a))}),i},p=function(n){var i=[];return n.parent().siblings().each(function(e,t){var a=I(t);0<=String(a.data("id")).indexOf("-")&&(String(a.data("id")).split("-")[0]==n.parent().data("parent")&&i.push(a))}),i},i=function(e){return e.hasClass(c.settings.iconUncollapsed)},f=function(e){e.toggleClass(c.settings.iconCollapsed),e.toggleClass(c.settings.iconUncollapsed)},C=function(e){return e.hasClass(c.settings.iconChecked)},m=function(e){e.toggleClass(c.settings.iconChecked),e.toggleClass(c.settings.iconUnchecked),e.parent().data("dirty",!0),l.data("dirty",!0)},k=function(e){e.addClass(c.settings.iconChecked),e.removeClass(c.settings.iconUnchecked),e.parent().data("dirty",!0),l.data("dirty",!0)},v=function(e){e.addClass(c.settings.iconUnchecked),e.removeClass(c.settings.iconChecked),e.parent().data("dirty",!0),l.data("dirty",!0)},S=function(e){e.addClass(c.settings.iconChecked),e.removeClass(c.settings.iconUnchecked),e.removeClass(c.settings.iconMixchecked);e.closest(".tree");c.settings.colorInHeader&&(e.parent().addClass("list-group-item-success"),e.parent().removeClass("list-group-item-warning"),e.parent().removeClass("list-group-item-danger"))},b=function(e){e.addClass(c.settings.iconUnchecked),e.removeClass(c.settings.iconChecked),e.removeClass(c.settings.iconMixchecked);e.closest(".tree");c.settings.colorInHeader&&(e.parent().removeClass("list-group-item-success"),e.parent().removeClass("list-group-item-warning"),e.parent().addClass("list-group-item-danger"))},x=function(e){e.removeClass(c.settings.iconUnchecked),e.removeClass(c.settings.iconChecked),e.addClass(c.settings.iconMixchecked);e.closest(".tree");c.settings.colorInHeader&&(e.parent().removeClass("list-group-item-success"),e.parent().addClass("list-group-item-warning"),e.parent().removeClass("list-group-item-danger"))};c.init()}else console.error("El plugin necesita el parÃ¡metro dataSource.")},I.fn.selectableTree=function(t){return this.each(function(){if(null==I(this).data("selectableTree")){var e=new I.selectableTree(this,t);I(this).data("selectableTree",e)}})}}(jQuery);
